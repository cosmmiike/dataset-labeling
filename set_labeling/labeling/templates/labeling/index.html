{% load static %}
{% load labeling_extras %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="{% static "labeling/styles/style.css" %}">
  <title>Dataset Labeling</title>
</head>

<body>
  <div class="labeling">
    <h1 class="labeling__title">Dataset Labeling</h1>
    <div class = "labeling__photo">
      <img class = "labeling__img" src="{% static photo %}" alt="Test photo" width="350">
      <p class = "labeling__img-link">{{ photo }}</p>
    </div>
    <form action="?id_photo={{ photo_num|add:1 }}" class="sets" method="POST">
      {% csrf_token %}
      <input type="hidden" name="photo-url" value="{{ photo }}">
      <ul class="sets__list">
        {% for key, set in sets.items %}
        <li class="set">
          <p class="set__title">{{ key }}</p>
          <ul class="set__items">
            {% if img_data == None %}
              {% for item in set %}
                <input class="set__input" type="radio" id="{{ key|add:"-radio-" }}{{ forloop.counter }}" name="{{ key|add:"-radio" }}" value="{{ forloop.counter0 }}" required>
                <label class="set__label" for="{{ key|add:"-radio-" }}{{ forloop.counter }}">
                  <span class="set__label-num">{{ forloop.counter }}</span>
                  {{ item }}
                </label>
              {% endfor %}
            {% else %}
            {% for item in set %}
              {% with data_key=img_data|get_item:key %}
                {% if forloop.counter0 == data_key|to_int %}
                  <input class="set__input" type="radio" id="{{ key|add:"-radio-" }}{{ forloop.counter }}" name="{{ key|add:"-radio" }}" value="{{ forloop.counter0 }}" checked required>
                {% else %}
                  <input class="set__input" type="radio" id="{{ key|add:"-radio-" }}{{ forloop.counter }}" name="{{ key|add:"-radio" }}" value="{{ forloop.counter0 }}">
                {% endif %}
              {% endwith %}
              <label class="set__label" for="{{ key|add:"-radio-" }}{{ forloop.counter }}">
                <span class="set__label-num">{{ forloop.counter }}</span>
                {{ item }}
              </label>
            {% endfor %}
            {%  endif %}
          </ul>
        </li>
        {% endfor %}
      </ul>
      <input class="set__submit" type="submit" value="Save & Go to the next photo" name="save-next">
      <a class="set__switch-link" id="switch-prev" href="?id_photo={{ photo_num|add:-1 }}">← Prev</a>
      <a class="set__switch-link" id="switch-next" href="?id_photo={{ photo_num|add:1 }}">Next →</a>
    </form>
  </div>

  <script type="text/javascript">
    document.onkeyup = function(e) {
      if (e.altKey && e.which == 37) {
        document.location.href = "?id_photo={{ photo_num|add:-1 }}";
      } else if (e.altKey && e.which == 39) {
        document.location.href = "?id_photo={{ photo_num|add:1 }}";
      }
    };
  </script>
</body>

</html>
